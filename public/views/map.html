<!-- Page Content -->
<div class="w3-padding-large">
  <div id="floating-panel">
    <button onclick="toggleHeatmap()" class="w3-btn w3-ripple w3-hover-grey ">Toggle Heatmap</button>
    <button onclick="toogleMarker()" class="w3-btn w3-ripple w3-hover-grey">Toogle Marker</button>

  </div>

  <div id="map"> </div>

 <script>
    var map;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 2,
            center: new google.maps.LatLng(2.8, -187.3),
            mapTypeId: 'terrain'
        });

       // Create a <script> tag and set the USGS URL as the source.
        var script = document.createElement('script');
        // This example uses a local copy of the GeoJSON stored at
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
        script.src = 'https://developers.google.com/maps/documentation/javascript/examples/json/earthquake_GeoJSONP.js';
        document.getElementsByTagName('head')[0].appendChild(script);
    }

    // Loop through the results array and place a marker for each
    // set of coordinates.
     window.eqfeed_callback = function (results) {
        for (var i = 0; i < results.features.length; i++) {
            var coords = results.features[i].geometry.coordinates;
            var latLng = new google.maps.LatLng(coords[1], coords[0]);
            var marker = new google.maps.Marker({
                position: latLng,
                map: map
            });
        }
    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTfca52fNfMGLndFS4DiLSaDpVrJE0kwA&callback=initMap">

</script>

  <script type="text/javascript">
          var utm = "+proj=utm +zone=45";
          var wgs84 = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";
          //console.log(proj4(utm,wgs84,[534479.73, 2598049.89]));

          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: new google.maps.LatLng(23.557979, 87.281364),
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            styles: [
              { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },
              { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },
              { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },
              {
                featureType: 'administrative.locality',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#d59563' }]
              },
              {
                featureType: 'poi',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#d59563' }]
              },
              {
                featureType: 'poi.park',
                elementType: 'geometry',
                stylers: [{ color: '#263c3f' }]
              },
              {
                featureType: 'poi.park',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#6b9a76' }]
              },
              {
                featureType: 'road',
                elementType: 'geometry',
                stylers: [{ color: '#38414e' }]
              },
              {
                featureType: 'road',
                elementType: 'geometry.stroke',
                stylers: [{ color: '#212a37' }]
              },
              {
                featureType: 'road',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#9ca5b3' }]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry',
                stylers: [{ color: '#746855' }]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry.stroke',
                stylers: [{ color: '#1f2835' }]
              },
              {
                featureType: 'road.highway',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#f3d19c' }]
              },
              {
                featureType: 'transit',
                elementType: 'geometry',
                stylers: [{ color: '#2f3948' }]
              },
              {
                featureType: 'transit.station',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#d59563' }]
              },
              {
                featureType: 'water',
                elementType: 'geometry',
                stylers: [{ color: '#17263c' }]
              },
              {
                featureType: 'water',
                elementType: 'labels.text.fill',
                stylers: [{ color: '#515c6d' }]
              },
              {
                featureType: 'water',
                elementType: 'labels.text.stroke',
                stylers: [{ color: '#17263c' }]
              }
            ]
          });

          var infowindow = new google.maps.InfoWindow();
          var heatmapData = [], markers = [];
          var marker, i, lat_longi;
          var locations;
          $.getJSON("geodata.json", function (json) {
            locations = json;
            //console.log(json); // this will show the info it in firebug console
            for (i = 0; i < locations.length; i++) {
              lat_longi = proj4(utm, wgs84, [locations[i].EASTING, locations[i].NORTHING]);
              //	console.log(lat_longi);
              marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat_longi[1], lat_longi[0]),
                map: map
              });
              markers.push(marker);
              //marker event
              google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                return function () {
                  infowindow.setContent("<p style='color:black;'>WQI = " + locations[i].WQI.toString() + "</p>");
                  infowindow.open(map, marker);
                }
              })(marker, i));
              google.maps.event.addListener(marker, 'click', (function (marker, i) {
                return function () {
                  window.open("/?id=" + locations[i].sampno);
                }
              })(marker, i));
              //heat map genarator
              heatmapData.push({ location: new google.maps.LatLng(lat_longi[1], lat_longi[0]), weight: locations[i].WQI / 100 });


            }
            console.log(heatmapData);
          });
          var gradient = [
            'rgba(0, 255, 255, 0)',
            'rgba(0, 255, 255, 1)',
            'rgba(0, 191, 255, 1)',
            'rgba(0, 127, 255, 1)',
            'rgba(0, 63, 255, 1)',
            'rgba(0, 0, 255, 1)',
            'rgba(0, 0, 223, 1)',
            'rgba(0, 0, 191, 1)',
            'rgba(0, 0, 159, 1)',
            'rgba(0, 0, 127, 1)',
            'rgba(63, 0, 91, 1)',
            'rgba(127, 0, 63, 1)',
            'rgba(191, 0, 31, 1)',
            'rgba(255, 0, 0, 1)'
          ]

          var heatmap = new google.maps.visualization.HeatmapLayer({
            data: heatmapData,
            radius: 10
          });
          heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
          heatmap.setMap(map);


          //	console.log("positions----->"+proj4(utm,wgs84,["+locations[i].NORTHING+", "+locations[i].EASTING+"])+" "+locations[i].EASTING +","+ locations[i].NORTHING);

          function toggleHeatmap() {
            heatmap.setMap(heatmap.getMap() ? null : map);
          }
          function toogleMarker() {
            for (var i = 0; i < markers.length; i++) {
              if (markers[i].getMap() === null) {
                markers[i].setMap(map);
              }
              else {
                markers[i].setMap(null);
              }
            }
          }
  </script>
  


</div>